name: CI

on: [push, pull_request]

jobs:
    phpstan:
        name: PHPStan
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@master
            - name: PHPStan
              uses: docker://oskarstark/phpstan-ga
              env:
                  REQUIRE_DEV: true
              with:
                  args: analyze --no-progress
    php-cs-fixer:
        name: PHP-CS-Fixer
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@master
            - name: PHP-CS-Fixer
              uses: docker://oskarstark/php-cs-fixer-ga
              with:
                  args: --dry-run --diff-format udiff
    phpunit:
        name: PHPUnit
        runs-on: ubuntu-latest
        strategy:
            matrix:
                include:
                    - php-version: 7.4
                      symfony-version: 4.4.*
                    - php-version: 7.4
                      symfony-version: 5.1.*
        steps:
            - name: "Checkout"
              uses: actions/checkout@v2.0.0
            - name: "Setup PHP"
              uses: shivammathur/setup-php@2.4.2
              with:
                  coverage: none
                  php-version: ${{ matrix.php-version }}
            - name: "Install dependencies with composer"
              run: |
                  composer require symfony/filesystem:${{ matrix.symfony-version }} symfony/process:${{ matrix.symfony-version }} --no-interaction --no-update
                  composer update --no-interaction --no-progress --no-suggest
            - name: "Run tests with phpunit/phpunit"
              run: vendor/bin/simple-phpunit
