name: Static code analysis

on: [push]

jobs:
  phpmd:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 5.6
      - name: Install Reviewdog
        run: |
          curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
      - name: Install PHPMD
        run: |
          composer global require phpmd/phpmd
          echo "::add-path::$(composer -q global config home)/vendor/bin"
      - name: PHPMD
        run: phpmd src text codesize,unusedcode,naming | ./bin/reviewdog -efm="%f:%l %m" -name="PHPMD" -reporter=github-check
        env:
          REVIEWDOG_TOKEN: ${{ secrets.REVIEWDOG_TOKEN }}
  phpcs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 5.6
      - name: Install Reviewdog
        run: |
          curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
      - name: Install PHPCS
        run: |
          composer global require squizlabs/php_codesniffer
          echo "::add-path::$(composer -q global config home)/vendor/bin"
      - name: PHPCS
        run: phpcs --standard=PSR2 --report=checkstyle src | ./bin/reviewdog -f=checkstyle -name="PHPCS" -reporter=github-check
        env:
          REVIEWDOG_TOKEN: ${{ secrets.REVIEWDOG_TOKEN }}
  phploc:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 5.6
      - name: Install PHPLOC
        run: |
          composer global require phploc/phploc
          echo "::add-path::$(composer -q global config home)/vendor/bin"
      - name: PHPLOC
        run: phploc src
