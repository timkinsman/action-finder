name: Static code analysis

on: [push]

jobs:
  phpmd:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Install Reviewdog
        run: |
          curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
      - name: Install PHPMD
        run: |
          wget -c https://phpmd.org/static/latest/phpmd.phar
          php phpmd.phar --version
      - name: PHPMD
        run: php phpmd.phar src text codesize,unusedcode,naming | ./bin/reviewdog -efm="%f:%l %m" -name="PHPMD" -reporter=github-check
        env:
          REVIEWDOG_TOKEN: ${{ secrets.REVIEWDOG_TOKEN }}
  phpcs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Install Reviewdog
        run: |
          curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
      - name: Install PHPCS
        run: |
          wget https://squizlabs.github.io/PHP_CodeSniffer/phpcs.phar
          php phpcs.phar --version
      - name: PHPCS
        run: php phpcs.phar --standard=PSR2 --report=checkstyle src | ./bin/reviewdog -f=checkstyle -name="PHPCS" -reporter=github-check
        env:
          REVIEWDOG_TOKEN: ${{ secrets.REVIEWDOG_TOKEN }}
  phploc:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Install PHPLOC
        run: |
          wget https://phar.phpunit.de/phploc.phar
          php phploc.phar --version
      - name: PHPLOC
        run: php phploc.phar src
