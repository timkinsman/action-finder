name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - name: Copy privkey
      env:
        PRIVKEY: ${{ secrets.PRIVKEY }}
        SSH_HOST: ${{ secrets.SSH_HOST }}
      run: echo "$PRIVKEY" > ~/privkey && chmod 0600 ~/privkey
    - name: Debug privkey
      run: cat ~/privkey
    - name: Deploy to hoblox
      run: |
        id
        ssh -i ~/privkey -o "StrictHostKeyChecking=no" $SSH_HOST -- 'cdbf && git pull && composer install -o --no-dev'
