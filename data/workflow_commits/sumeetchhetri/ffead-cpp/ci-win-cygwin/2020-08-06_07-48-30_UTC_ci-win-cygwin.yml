name: Build ffead-cpp on windows cygwin

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  windows-cywgin:
    runs-on: ${{ matrix.os }}
    #if: "!contains(github.event.head_commit.message, '[skip_build]')"
    strategy:
      matrix:
        os: [windows-2019]
        vs: [2019]
    steps:
    - uses: actions/checkout@v2
    - name: Install cygwin
      run: |
        choco install -y cygwin
        choco install -y cyg-get
        cyg-get gcc gcc-g++ autmake patch bzip2 perl tar xz autoconf make zlib-devel zlib cmake git curl libcurl-devel libuuid-devel gdb libssl-devel wget dos2unix unzip
    - name: Set ENV
      run: |
        echo '::set-env name=PATH::C:\tools\cygwin\bin;C:\tools\cygwin\usr\bin'
    - name: Install dependencies and ffead-cpp
      run: |
        bash --login -c "cd /tmp && wget https://raw.githubusercontent.com/sumeetchhetri/ffead-cpp/master/docker/install_cywgin.sh && dos2unix install_cywgin.sh && chmod +x install_cywgin.sh && ./install_cywgin.sh"
        set ErrorLevel=%ErrorLevel%
